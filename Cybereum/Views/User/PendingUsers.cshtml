@model List<SelectListItem>

@{
    ViewBag.Title = "Pending Users";
    Layout = "~/Views/Shared/_Layout.cshtml";
}
<style>
    #button {
        display: block;
        margin: 20px auto;
        padding: 10px 30px;
        background-color: #eee;
        border: solid #ccc 1px;
        cursor: pointer;
    }

    #overlay {
        position: fixed;
        top: 0;
        z-index: 100;
        width: 100%;
        height: 100%;
        display: none;
        background: rgba(0,0,0,0.6);
    }

    .cv-spinner {
        height: 100%;
        display: flex;
        justify-content: center;
        align-items: center;
    }

    .spinner {
        width: 40px;
        height: 40px;
        border: 4px #ddd solid;
        border-top: 4px #2e93e6 solid;
        border-radius: 50%;
        animation: sp-anime 0.8s infinite linear;
    }

    @@keyframes sp-anime {
        100% {
            transform: rotate(360deg);
        }
    }

    .is-hide {
        display: none;
    }

    #divLoader {
        position: fixed;
        display: block;
        width: 100%;
        height: 100%;
        top: 0;
        left: 0;
        text-align: center;
        opacity: 0.7;
        background-color: #fff;
        z-index: 99;
    }

    #loading-image {
        position: absolute;
        top: 50%;
        left: 50%;
        z-index: 100;
    }
</style>


<div class="main-content">

    <div class="page-content">
        <div class="container-fluid">
            <div class="form-horizontal">
                <h4>Pending Users List</h4>
                <hr />
            </div>

            <div class="col-12">
                <div id="divLoader" style="display:none;">
                    <img id="loading-image" src="~/images/Spinner.gif" alt="Loader" />
                </div>
                <div class="card">
                    <div class="card-body">
                        <div class="table-responsive">
                            <table id="tblPendingUser" class="table table-hover mb-0" width="100%">
                                <thead>
                                    <tr>
                                        <th>First Name</th>
                                        <th>Last Name</th>
                                        <th>Email Id</th>
                                        <th>Role Name</th>
                                        <th>Organization</th>
                                        <th>Accept</th>
                                        <th>Reject</th>
                                    </tr>
                                </thead>
                                <tbody></tbody>
                            </table>

                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>


@Scripts.Render("~/bundles/jquery")
<script type="text/javascript">
    $(document).ajaxSend(function () {
        $("#overlay").fadeIn(300);
    });

    $(document).ready(function () {
        $('#liFiles').addClass("active");
        

        debugger;
        var reset = 0;
        var objFilter = {
        }

        $("#tblPendingUser").DataTable(
        {
            processing: true,
            serverSide: true,
            filter: false,
            orderMulti: false,
            paging: false,
            Sort: true,
            "ajax": {
                url: '@Url.Action("GetPendingUser", "User")',
                type: 'POST'
            },
            aoColumnDefs: [{
                bSortable: false,
                aTargets: [-1, -2]
            }],
            "bAutoWidth": false,
            "info": true,
            columns: [
                { 'data': 'firstname', 'name': 'First Name' },
                { 'data': 'lastname', 'name': 'Last Name' },
                { 'data': 'emailid', 'name': 'Email ID' },
                { 'data': 'rolename', 'name': 'Role Name' },
                { 'data': 'organization', 'name': 'Organization' },                
                {
                    data: 'firstname', render: function (data, type, row) {
                        return "<a><button type='submit' onclick=AcceptData('" + encodeURIComponent(row.userid) + "'); class='btn btn-outline-primary btn-sm waves-effect waves-light'>Accept</button></a>";                        
                    }
                },
                {
                    data: 'firstname', render: function (data, type, row) {
                        return "<a><button type='submit' onclick=RejectData('" + encodeURIComponent(row.userid) + "'); class='btn btn-outline-primary btn-sm waves-effect waves-light'>Reject</button></a>";
                    }
                }
            ],
            select: {
                style: 'multi',
                selector: 'td:first-child'
            },
        });
    });


    function AcceptData(userid) {
        $("#divLoader").show();
        debugger;
        $.ajax(
        {
            url: '@Url.Action("AcceptUser", "User")',
            contentType: 'application/json; charset=utf-8',
            datatype: 'json',
            async: true,
            data: {
                datuserid: userid
            },
            type: "GET",
            success: function (response) {
                $("#overlay").fadeOut(300);
                debugger;
                if (response == "Success") {
                    alert(response);
                    window.location = '@Url.Action("PendingUsers", "User")?userid=' + userid;                    
                    window.open(link);
                    $("#divLoader").hide();
                }
                else
                    alert(response);
                $("#divLoader").hide();
            }
        });
    }

    function RejectData(userid) {
        debugger;
        $("#divLoader").show();
        $.ajax(
        {
            url: '@Url.Action("RejectUser", "User")',
            contentType: 'application/json; charset=utf-8',
            datatype: 'json',
            async: true,
            data: {
                datuserid: userid
            },
            type: "GET",
            success: function (response) {
                $("#overlay").fadeOut(300);
                debugger;
                if (response == "Success") {
                    alert('Rejected the selected user');
                    window.location = '@Url.Action("PendingUsers", "User")?userid=' + userid;
                    $("#divLoader").hide();
                }
                else {
                    alert(response);
                    $("#divLoader").hide();
                }
            }
        });
    }
    
    function msg(strMsg, mode) {
        $.notify(strMsg, mode, { globalPosition: 'top center', clickToHide: true, autoHide: false });
    }


</script>
